# Backend Environment Configuration (.env.production)

## üî¥ VARIABLES CR√çTICAS - REEMPLAZAR ANTES DE PRODUCCI√ìN

### Base de Datos
```env
# PostgreSQL Primary Database
DB_HOST=db.your-server.com
DB_PORT=5432
DB_NAME=spartan_market_prod
DB_USER=spartan_user_prod
DB_PASSWORD=your_very_strong_password_min_32_chars

# Async Connection String
DATABASE_URL=postgresql+asyncpg://spartan_user_prod:your_very_strong_password@db.your-server.com:5432/spartan_market_prod
SQLALCHEMY_DATABASE_URL=postgresql://spartan_user_prod:your_very_strong_password@db.your-server.com:5432/spartan_market_prod
```

### Redis Cache
```env
REDIS_HOST=redis.your-server.com
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_32_chars
REDIS_DB=0
REDIS_URL=redis://:your_redis_password@redis.your-server.com:6379/0
```

### Cloudflare R2 Storage
```env
R2_ENDPOINT_URL=https://your-account-id.r2.cloudflarestorage.com
R2_ACCESS_KEY_ID=your_r2_access_key_id
R2_SECRET_ACCESS_KEY=your_r2_secret_access_key
R2_BUCKET_NAME=spartan-market-prod
R2_BACKUP_BUCKET_NAME=spartan-backups-prod
R2_PUBLIC_URL=https://cdn.spartan-edge.com
```

### Firebase Authentication
```env
FIREBASE_PROJECT_ID=spartan-market-prod
FIREBASE_PRIVATE_KEY_ID=your_firebase_private_key_id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_FULL_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@spartan-market-prod.iam.gserviceaccount.com
FIREBASE_CLIENT_ID=your_firebase_client_id
FIREBASE_AUTH_URI=https://accounts.google.com/o/oauth2/auth
FIREBASE_TOKEN_URI=https://oauth2.googleapis.com/token
FIREBASE_AUTH_PROVIDER_X509_CERT_URL=https://www.googleapis.com/oauth2/v1/certs
FIREBASE_CLIENT_X509_CERT_URL=https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-xxxxx%40spartan-market-prod.iam.gserviceaccount.com
```

### MercadoPago Payments (PRODUCTION)
```env
# ‚ö†Ô∏è USAR TOKENS DE PRODUCCI√ìN, NO SANDBOX
MERCADOPAGO_ACCESS_TOKEN=APP_USR-your_production_access_token_here
MERCADOPAGO_PUBLIC_KEY=APP_USR-your_production_public_key_here
MERCADOPAGO_WEBHOOK_SECRET=your_webhook_secret_token
```

### Brevo Email Service
```env
BREVO_API_KEY=your_brevo_api_key_production
BREVO_SMTP_USER=your_smtp_user@your-domain.com
BREVO_SMTP_KEY=your_brevo_smtp_key
BREVO_SENDER_EMAIL=noreply@spartan-edge.com
BREVO_SENDER_NAME=Spartan Market
```

### Sentry Error Tracking
```env
SENTRY_DSN=https://your_key@sentry.io/your_project_id
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
```

### Application Configuration
```env
# Environment & Debug
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=WARNING
API_VERSION=v1

# Domain Configuration
DOMAIN=spartan-edge.com
CORS_ORIGINS=https://spartan-edge.com,https://www.spartan-edge.com,https://spartan-edge.vercel.app

# Security
SECRET_KEY=your_generated_secret_key_min_32_chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Rate Limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600
RATE_LIMIT_ENABLED=true

# Monitoring
ENABLE_SENTRY=true
ENABLE_PROMETHEUS=true
PROMETHEUS_PORT=9090

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 2 AM every day
BACKUP_RETENTION_DAYS=30
BACKUP_TO_R2=true

# SSL/TLS
CERT_PATH=/etc/letsencrypt/live/spartan-edge.com/cert.pem
KEY_PATH=/etc/letsencrypt/live/spartan-edge.com/privkey.pem
SSL_VERIFY=true
```

### Optional: Slack Notifications
```env
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_ERROR_CHANNEL=#errors
SLACK_WARNING_CHANNEL=#warnings
```

### Optional: AWS Secrets Manager Integration
```env
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_SECRETS_MANAGER_ENABLED=false
```

---

## üîß How to Generate Missing Values

### Generate SECRET_KEY
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

### Get Firebase Private Key
1. Go to https://console.firebase.google.com
2. Select your project
3. Settings ‚Üí Service Accounts ‚Üí Generate New Key
4. Copy the JSON content
5. Extract `private_key` value

### Get MercadoPago Production Token
1. Go to https://www.mercadopago.com/developers
2. Your integrations ‚Üí Production
3. Copy Access Token and Public Key

### Get Brevo API Key
1. Go to https://app.brevo.com/account/settings/smtp-oauth
2. Under SMTP, click "Enable"
3. Copy SMTP Key

---

## ‚úÖ Security Checklist Before Production

- [ ] All passwords are 32+ characters
- [ ] Firebase private key is properly escaped (newlines as \n)
- [ ] MercadoPago token is from PRODUCTION, not sandbox
- [ ] R2 bucket is set to private (not public read)
- [ ] Database user has limited permissions (not superuser)
- [ ] SSL certificate is valid (not self-signed)
- [ ] CORS_ORIGINS doesn't include *
- [ ] No hardcoded values, everything from env vars
- [ ] Secrets backed up securely
- [ ] .env.production is in .gitignore
- [ ] All services are behind firewall/security groups

---

## üìù Notes

- This is `.env.production` - for production deployment only
- Use `.env.example` as template for other environments
- Never commit actual credentials to repository
- Rotate secrets regularly (monthly)
- Keep backup of encryption keys in secure location
- Monitor failed authentication attempts in logs

